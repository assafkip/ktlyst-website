<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Signals Intelligence | KTLYST Labs</title>
    <meta name="description" content="Real-time security intelligence from government advisories, threat research, and vulnerability databases.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a5f;
            --primary-light: #2d4a6f;
            --accent: #3b82f6;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            padding: 24px 32px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid var(--gray-300);
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .stat-card .label {
            font-size: 0.8rem;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filters-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .filters-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 16px;
        }

        .filters-row:last-child {
            margin-bottom: 0;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 10px 14px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        select {
            padding: 10px 14px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
            cursor: pointer;
            min-width: 150px;
        }

        select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .refresh-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .refresh-btn:hover {
            background: #0f172a;
        }

        .chip {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            font-weight: 500;
        }

        .chip.active {
            background: var(--primary) !important;
            color: white !important;
            border-color: var(--primary) !important;
        }

        .chip-all { background: var(--gray-100); color: var(--gray-700); border-color: var(--gray-300); }
        .chip-critical { background: #fef2f2; color: #dc2626; border-color: #fecaca; }
        .chip-high { background: #fff7ed; color: #ea580c; border-color: #fed7aa; }
        .chip-medium { background: #fffbeb; color: #d97706; border-color: #fde68a; }
        .chip-low { background: #ecfdf5; color: #059669; border-color: #a7f3d0; }
        .chip-info { background: #eff6ff; color: #2563eb; border-color: #bfdbfe; }

        .category-chips {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .category-chip {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .source-legend {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            font-size: 0.7rem;
        }

        .source-legend span {
            padding: 3px 10px;
            border-radius: 4px;
            color: white;
        }

        .signals-count {
            color: var(--gray-500);
            font-size: 0.9rem;
            margin-bottom: 16px;
        }

        .signals-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .signal-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: box-shadow 0.2s;
            border-left: 4px solid var(--gray-300);
        }

        .signal-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .signal-card.critical { border-left-color: #dc2626; }
        .signal-card.high { border-left-color: #ea580c; }
        .signal-card.medium { border-left-color: #d97706; }

        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            gap: 12px;
        }

        .signal-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--gray-800);
            flex: 1;
        }

        .signal-title a {
            color: inherit;
            text-decoration: none;
        }

        .signal-title a:hover {
            color: var(--accent);
        }

        .signal-source {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        .signal-badges {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            align-items: center;
        }

        .badge {
            padding: 3px 10px;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .badge-severity {
            text-transform: uppercase;
        }

        .badge-critical { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .badge-high { background: #fff7ed; color: #ea580c; border: 1px solid #fed7aa; }
        .badge-medium { background: #fffbeb; color: #d97706; border: 1px solid #fde68a; }
        .badge-low { background: #f0fdf4; color: #16a34a; border: 1px solid #bbf7d0; }
        .badge-informational { background: #f3f4f6; color: #6b7280; border: 1px solid #e5e7eb; }

        .badge-category {
            background: #e0e7ff;
            color: #3730a3;
        }

        .badge-date {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .badge-date.fresh {
            background: #dcfce7;
            color: #16a34a;
        }

        .badge-date.stale {
            background: #fef3c7;
            color: #d97706;
        }

        .signal-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .tag-cve {
            background: #fee2e2;
            color: #dc2626;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-family: monospace;
        }

        .tag-actor {
            background: #fef3c7;
            color: #b45309;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        .tag-malware {
            background: #fce7f3;
            color: #be185d;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        .signal-summary {
            font-size: 0.9rem;
            color: var(--gray-700);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .signal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid var(--gray-100);
        }

        .signal-link {
            color: var(--accent);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .signal-link:hover {
            text-decoration: underline;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }

        .footer {
            text-align: center;
            padding: 24px;
            color: var(--gray-500);
            font-size: 0.85rem;
        }

        .footer a {
            color: var(--accent);
            text-decoration: none;
        }

        /* Environment filter chips */
        .env-chip {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            border: 1px solid var(--gray-300);
            background: var(--gray-50);
            color: var(--gray-600);
            transition: all 0.2s;
        }

        .env-chip:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .env-chip.active {
            background: #059669;
            color: white;
            border-color: #059669;
        }

        .env-chip-summary {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            background: #dcfce7;
            color: #059669;
            margin-right: 4px;
        }

        /* Focus tab styles */
        .focus-tab {
            transition: all 0.2s;
        }

        .focus-tab:hover {
            transform: translateY(-1px);
        }

        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }
            .container {
                padding: 16px;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .signal-header {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav id="mainNav" style="position: fixed; top: 0; left: 0; right: 0; z-index: 100; background: rgba(30, 58, 95, 0.95); backdrop-filter: blur(8px); border-bottom: 1px solid rgba(59, 130, 246, 0.2); transition: all 0.3s;">
        <div style="max-width: 1400px; margin: 0 auto; padding: 0 24px;">
            <div style="display: flex; items-center: center; justify-content: space-between; height: 56px;">
                <!-- Logo -->
                <a href="/" style="display: flex; align-items: center; gap: 8px; text-decoration: none;">
                    <span style="font-size: 1.25rem; font-weight: 700; font-family: monospace; color: #3b82f6;">KTLYST</span>
                    <span style="color: #9ca3af; font-size: 0.875rem; font-family: monospace;">Labs</span>
                </a>
                <!-- Navigation Links -->
                <div style="display: flex; align-items: center; gap: 24px;">
                    <a href="/" style="color: #9ca3af; text-decoration: none; font-size: 0.875rem; transition: color 0.2s;" onmouseover="this.style.color='#3b82f6'" onmouseout="this.style.color='#9ca3af'">Home</a>
                    <a href="/signals" style="color: #3b82f6; text-decoration: none; font-size: 0.875rem; font-weight: 500;">Signals</a>
                </div>
            </div>
        </div>
    </nav>

    <header class="header" style="margin-top: 56px;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 16px;">
            <div>
                <h1>Security Signals Intelligence</h1>
                <p>Real-time CVEs, threat intelligence, and security research from government advisories and vendor research</p>
            </div>
            <div style="background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); border-radius: 8px; padding: 8px 14px; text-align: right;">
                <div style="font-size: 0.7rem; color: rgba(255,255,255,0.7); text-transform: uppercase; letter-spacing: 0.5px;">Last Updated</div>
                <div style="font-size: 0.9rem; font-weight: 600; color: white;" id="lastUpdatedTime">--</div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Stats -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card" style="border-left-color: #1e3a5f;">
                <div class="number" id="statTotal">-</div>
                <div class="label">Total Signals</div>
            </div>
            <div class="stat-card" style="border-left-color: #dc2626;">
                <div class="number" id="statCritical">-</div>
                <div class="label">Critical</div>
            </div>
            <div class="stat-card" style="border-left-color: #ea580c;">
                <div class="number" id="statHigh">-</div>
                <div class="label">High</div>
            </div>
            <div class="stat-card" style="border-left-color: #d97706;">
                <div class="number" id="statMedium">-</div>
                <div class="label">Medium</div>
            </div>
            <div class="stat-card" style="border-left-color: #0369a1;">
                <div class="number" id="statSources">-</div>
                <div class="label">Sources</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-section">
            <div class="filters-row">
                <input type="text" id="searchInput" class="search-input" placeholder="Search CVE, threat actor, malware...">
                <select id="filterDate">
                    <option value="all">All Time</option>
                    <option value="1day">Past 24h</option>
                    <option value="7days" selected>Past 7 Days</option>
                    <option value="14days">Past 14 Days</option>
                    <option value="month">Past Month</option>
                </select>
                <select id="filterSourceType">
                    <option value="all">All Source Types</option>
                    <option value="government">Government</option>
                    <option value="vendor_research">Vendor Research</option>
                    <option value="independent_research">Independent Research</option>
                    <option value="vulnerability_db">Vulnerability DB</option>
                    <option value="threat_tracking">Threat Tracking</option>
                    <option value="news">News</option>
                    <option value="community">Community</option>
                </select>
                <select id="filterSeverity">
                    <option value="all">All Severities</option>
                    <option value="critical">Critical</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                    <option value="informational">Informational</option>
                </select>
                <select id="filterCategory">
                    <option value="all">All Categories</option>
                    <option value="cve">CVE / Vulnerability</option>
                    <option value="malware">Malware</option>
                    <option value="apt">APT / Threat Actor</option>
                    <option value="advisory">Advisory</option>
                    <option value="news">News</option>
                    <option value="research">Research</option>
                </select>
                <select id="filterSource">
                    <option value="all">All Sources</option>
                    <optgroup label="Government / CERT">
                        <option value="CISA KEV">CISA KEV (Exploited)</option>
                        <option value="CISA ICS-CERT">CISA ICS-CERT</option>
                        <option value="CERT/CC">CERT/CC</option>
                        <option value="NCSC UK">NCSC UK</option>
                    </optgroup>
                    <optgroup label="Vendor Research">
                        <option value="Cisco Talos">Cisco Talos</option>
                        <option value="CrowdStrike Blog">CrowdStrike</option>
                        <option value="ESET WeLiveSecurity">ESET</option>
                        <option value="Kaspersky Securelist">Kaspersky</option>
                        <option value="Malwarebytes Labs">Malwarebytes</option>
                        <option value="Microsoft Security Blog">Microsoft</option>
                        <option value="Qualys Security Blog">Qualys</option>
                        <option value="SentinelOne">SentinelOne</option>
                        <option value="Trend Micro">Trend Micro</option>
                        <option value="Unit 42 (Palo Alto)">Unit 42</option>
                    </optgroup>
                    <optgroup label="News">
                        <option value="Bleeping Computer">Bleeping Computer</option>
                        <option value="CyberScoop">CyberScoop</option>
                        <option value="Dark Reading">Dark Reading</option>
                        <option value="Risky Biz News">Risky Biz</option>
                        <option value="SecurityWeek">SecurityWeek</option>
                        <option value="The Hacker News">The Hacker News</option>
                        <option value="The Record">The Record</option>
                    </optgroup>
                    <optgroup label="Independent Research">
                        <option value="Krebs on Security">Krebs on Security</option>
                        <option value="SANS ISC">SANS ISC</option>
                        <option value="Schneier on Security">Schneier</option>
                    </optgroup>
                    <optgroup label="Threat Tracking">
                        <option value="Exploit Database">Exploit Database</option>
                        <option value="Ransomware Live">Ransomware Live</option>
                    </optgroup>
                    <optgroup label="Community">
                        <option value="Reddit r/cybersecurity">Reddit</option>
                    </optgroup>
                </select>
                <button class="refresh-btn" onclick="loadSignals()">Refresh</button>
            </div>

            <div class="filters-row">
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <span class="chip chip-all active" data-severity="all">All</span>
                    <span class="chip chip-critical" data-severity="critical">Critical</span>
                    <span class="chip chip-high" data-severity="high">High</span>
                    <span class="chip chip-medium" data-severity="medium">Medium</span>
                    <span class="chip chip-low" data-severity="low">Low</span>
                    <span class="chip chip-info" data-severity="informational">Info</span>
                </div>
            </div>

            <div class="filters-row">
                <div class="category-chips" id="categoryChips">
                    <span class="category-chip" data-category="all" style="background: #1e3a5f; color: white;">All</span>
                    <span class="category-chip" data-category="cve" style="background: #fee2e2; color: #dc2626;">CVE: <span id="catCve">0</span></span>
                    <span class="category-chip" data-category="advisory" style="background: #dbeafe; color: #1d4ed8;">Advisory: <span id="catAdvisory">0</span></span>
                    <span class="category-chip" data-category="apt" style="background: #fef3c7; color: #d97706;">APT: <span id="catApt">0</span></span>
                    <span class="category-chip" data-category="malware" style="background: #fce7f3; color: #be185d;">Malware: <span id="catMalware">0</span></span>
                    <span class="category-chip" data-category="news" style="background: #f3f4f6; color: #374151;">News: <span id="catNews">0</span></span>
                    <span class="category-chip" data-category="research" style="background: #d1fae5; color: #059669;">Research: <span id="catResearch">0</span></span>
                </div>
            </div>

            <div class="filters-row">
                <div class="source-legend">
                    <span style="background: #0369a1;">Government</span>
                    <span style="background: #7c3aed;">Vendor Research</span>
                    <span style="background: #059669;">Independent</span>
                    <span style="background: #dc2626;">Vulnerability DB</span>
                    <span style="background: #ea580c;">Threat Tracking</span>
                    <span style="background: #6b7280;">News</span>
                </div>
            </div>
        </div>

        <!-- AI-Generated Summary Section -->
        <div id="summarySection" style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div>
                    <h2 style="font-size: 1.25rem; font-weight: 600; color: var(--gray-800); margin-bottom: 4px;">Daily Security Brief</h2>
                    <p id="summaryMeta" style="font-size: 0.85rem; color: var(--gray-500);">Loading summary...</p>
                </div>
                <span style="background: #ecfdf5; color: #059669; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500;">ü§ñ AI Generated</span>
            </div>

            <div id="summaryContent" style="display: none;">
                <div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-left: 4px solid #3b82f6; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="font-size: 0.75rem; font-weight: 600; color: #3b82f6; text-transform: uppercase; margin-bottom: 8px;">Executive Summary</h4>
                    <p id="executiveSummary" style="color: var(--gray-700); line-height: 1.7;"></p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
                    <div style="background: #fef2f2; border-radius: 8px; padding: 16px;">
                        <h4 style="font-size: 0.8rem; font-weight: 600; color: #dc2626; margin-bottom: 12px;">‚ö†Ô∏è KEY THREATS</h4>
                        <ul id="keyThreats" style="list-style: disc; padding-left: 20px; font-size: 0.9rem; color: var(--gray-700);"></ul>
                    </div>
                    <div style="background: #fff7ed; border-radius: 8px; padding: 16px;">
                        <h4 style="font-size: 0.8rem; font-weight: 600; color: #ea580c; margin-bottom: 12px;">üî¥ KEY CVEs</h4>
                        <ul id="keyCves" style="list-style: disc; padding-left: 20px; font-size: 0.9rem; color: var(--gray-700);"></ul>
                    </div>
                    <div style="background: #ecfdf5; border-radius: 8px; padding: 16px;">
                        <h4 style="font-size: 0.8rem; font-weight: 600; color: #059669; margin-bottom: 12px;">‚úÖ RECOMMENDATIONS</h4>
                        <ul id="recommendations" style="list-style: disc; padding-left: 20px; font-size: 0.9rem; color: var(--gray-700);"></ul>
                    </div>
                </div>

                <!-- Collapsible Details Section -->
                <div id="summaryDetailsToggle" style="display: none; margin-top: 16px;">
                    <button onclick="toggleSummaryDetails()" style="display: flex; align-items: center; gap: 6px; background: none; border: 1px solid var(--gray-300); padding: 8px 14px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; color: var(--gray-600); width: 100%;">
                        <span id="summaryDetailsArrow" style="transition: transform 0.2s;">‚ñ∂</span>
                        <span>Show Details (Detection Opportunities & Trends)</span>
                    </button>
                    <div id="summaryDetailsContent" style="display: none; margin-top: 12px;">
                        <div id="summaryDetectionOps" style="display: none; background: white; padding: 14px; border-radius: 8px; margin-bottom: 12px; border: 1px solid #c4b5fd;">
                            <div style="font-weight: 600; font-size: 0.8rem; color: #7c3aed; margin-bottom: 8px;">üéØ DETECTION OPPORTUNITIES</div>
                            <p id="summaryDetectionText" style="margin: 0; font-size: 0.85rem; line-height: 1.5; color: var(--gray-700);"></p>
                        </div>
                        <div id="summaryTrends" style="display: none; background: white; padding: 14px; border-radius: 8px; border: 1px solid #bfdbfe;">
                            <div style="font-weight: 600; font-size: 0.8rem; color: #2563eb; margin-bottom: 8px;">üìà TRENDS</div>
                            <p id="summaryTrendsText" style="margin: 0; font-size: 0.85rem; line-height: 1.5; color: var(--gray-700);"></p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="summaryLoading" style="text-align: center; padding: 20px; color: var(--gray-500);">
                Loading AI-generated summary...
            </div>
        </div>

        <!-- Collapsible Industry Focus Section -->
        <div id="focusSectionWrapper" style="display: none; margin-bottom: 24px; border: 1px solid var(--gray-200); border-radius: 12px; overflow: hidden; background: white;">
            <button onclick="toggleFocusSection()" style="display: flex; align-items: center; justify-content: space-between; width: 100%; background: var(--gray-50); border: none; padding: 14px 20px; cursor: pointer; text-align: left;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span id="focusSectionArrow" style="transition: transform 0.2s; color: var(--gray-500);">‚ñ∂</span>
                    <span style="font-size: 0.95rem; font-weight: 500; color: var(--gray-700);">üéØ Industry Focus Views</span>
                    <span style="font-size: 0.8rem; color: var(--gray-400);">(Detection, SOC Ops, Ransomware)</span>
                </div>
            </button>
            <div id="focusSectionContent" style="display: none; padding: 20px;">
                <!-- Focus Tabs -->
                <div style="display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; align-items: center;">
                    <span style="font-size: 0.85rem; color: var(--gray-500); font-weight: 500;">Focus:</span>
                    <button class="focus-tab active" data-focus="detection_engineering" style="padding: 8px 18px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; border: 1px solid #8b5cf6; background: #7c3aed; color: white;">üõ°Ô∏è Detection</button>
                    <button class="focus-tab" data-focus="soc_operations" style="padding: 8px 18px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; border: 1px solid #8b5cf6; background: #f5f3ff; color: #7c3aed;">üñ•Ô∏è SOC Ops</button>
                    <button class="focus-tab" data-focus="ransomware" style="padding: 8px 18px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; border: 1px solid #8b5cf6; background: #f5f3ff; color: #7c3aed;">üîí Ransomware</button>
                </div>
                <!-- Industry Focus Summary -->
                <div id="focusSummaryContent" style="display: none; background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); border: 1px solid #c4b5fd; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
                        <div>
                            <h3 id="focusTitle" style="margin: 0 0 4px 0; font-size: 1.1rem; color: #5b21b6;">Industry Focus</h3>
                            <span id="focusMeta" style="font-size: 0.75rem; color: var(--gray-500);"></span>
                        </div>
                        <span style="padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; background: #ede9fe; color: #7c3aed;">üéØ Specialized View</span>
                    </div>
                    <div style="background: white; padding: 14px; border-radius: 8px; margin-bottom: 16px; border-left: 3px solid #7c3aed;">
                        <div style="font-weight: 600; font-size: 0.8rem; color: var(--gray-500); margin-bottom: 6px;">SUMMARY</div>
                        <p id="focusSummaryText" style="margin: 0; font-size: 0.95rem; line-height: 1.6; color: var(--gray-700);"></p>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
                        <div style="background: white; padding: 14px; border-radius: 8px;">
                            <div style="font-weight: 600; font-size: 0.8rem; color: #dc2626; margin-bottom: 8px;">‚ö†Ô∏è RELEVANT THREATS</div>
                            <ul id="focusThreats" style="margin: 0; padding-left: 18px; font-size: 0.85rem; color: var(--gray-700); list-style: disc;"></ul>
                        </div>
                        <div style="background: white; padding: 14px; border-radius: 8px;">
                            <div style="font-weight: 600; font-size: 0.8rem; color: #059669; margin-bottom: 8px;">‚úÖ RECOMMENDATIONS</div>
                            <ul id="focusRecs" style="margin: 0; padding-left: 18px; font-size: 0.85rem; color: var(--gray-700); list-style: disc;"></ul>
                        </div>
                    </div>
                    <div id="focusImpact" style="margin-top: 16px; background: white; padding: 14px; border-radius: 8px; display: none;">
                        <div style="font-weight: 600; font-size: 0.8rem; color: #2563eb; margin-bottom: 8px;">üìä IMPACT ASSESSMENT</div>
                        <p id="focusImpactText" style="margin: 0; font-size: 0.85rem; line-height: 1.5; color: var(--gray-700);"></p>
                    </div>
                </div>
                <div id="focusLoading" style="text-align: center; padding: 20px; color: var(--gray-500); display: none;">
                    Loading focus summary...
                </div>
            </div>
        </div>

        <!-- My Environment Filter Bar -->
        <div id="envFilterBar" style="margin-bottom: 24px; border: 1px solid var(--gray-200); border-radius: 12px; overflow: hidden; background: white;">
            <!-- Collapsed State -->
            <div id="envFilterCollapsed" style="display: flex; align-items: center; justify-content: space-between; padding: 12px 20px; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); cursor: pointer;" onclick="toggleEnvFilter()">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 1.1rem;">üéØ</span>
                    <span style="font-weight: 500; color: var(--gray-700);">My Environment</span>
                    <div id="envFilterSummary" style="display: flex; gap: 6px; flex-wrap: wrap;">
                        <span style="font-size: 0.8rem; color: var(--gray-500); font-style: italic;">No filters applied - showing all signals</span>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span id="envFilterCount" style="font-size: 0.8rem; color: var(--gray-500);"></span>
                    <button onclick="event.stopPropagation(); clearEnvFilters();" style="font-size: 0.75rem; padding: 4px 8px; border: 1px solid var(--gray-300); border-radius: 4px; background: white; color: var(--gray-600); cursor: pointer;">Clear</button>
                    <span id="envFilterArrow" style="color: var(--gray-400); transition: transform 0.2s;">‚ñº</span>
                </div>
            </div>
            <!-- Expanded State -->
            <div id="envFilterExpanded" style="display: none; padding: 20px; border-top: 1px solid var(--gray-200); background: white;">
                <!-- Cloud -->
                <div style="margin-bottom: 14px;">
                    <div style="font-size: 0.75rem; font-weight: 600; color: var(--gray-500); margin-bottom: 8px; text-transform: uppercase;">Cloud Platform</div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="env-chip" data-category="cloud" data-value="aws" onclick="toggleEnvChip(this)">AWS</button>
                        <button class="env-chip" data-category="cloud" data-value="azure" onclick="toggleEnvChip(this)">Azure</button>
                        <button class="env-chip" data-category="cloud" data-value="gcp" onclick="toggleEnvChip(this)">GCP</button>
                        <button class="env-chip" data-category="cloud" data-value="on-prem" onclick="toggleEnvChip(this)">On-Prem</button>
                    </div>
                </div>
                <!-- Infrastructure -->
                <div style="margin-bottom: 14px;">
                    <div style="font-size: 0.75rem; font-weight: 600; color: var(--gray-500); margin-bottom: 8px; text-transform: uppercase;">Infrastructure</div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="env-chip" data-category="infra" data-value="kubernetes" onclick="toggleEnvChip(this)">Kubernetes</button>
                        <button class="env-chip" data-category="infra" data-value="docker" onclick="toggleEnvChip(this)">Docker</button>
                        <button class="env-chip" data-category="infra" data-value="vmware" onclick="toggleEnvChip(this)">VMware</button>
                        <button class="env-chip" data-category="infra" data-value="terraform" onclick="toggleEnvChip(this)">Terraform</button>
                        <button class="env-chip" data-category="infra" data-value="linux" onclick="toggleEnvChip(this)">Linux</button>
                        <button class="env-chip" data-category="infra" data-value="windows" onclick="toggleEnvChip(this)">Windows</button>
                    </div>
                </div>
                <!-- Security Tools -->
                <div style="margin-bottom: 14px;">
                    <div style="font-size: 0.75rem; font-weight: 600; color: var(--gray-500); margin-bottom: 8px; text-transform: uppercase;">Security Stack</div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="env-chip" data-category="security" data-value="crowdstrike" onclick="toggleEnvChip(this)">CrowdStrike</button>
                        <button class="env-chip" data-category="security" data-value="sentinelone" onclick="toggleEnvChip(this)">SentinelOne</button>
                        <button class="env-chip" data-category="security" data-value="microsoft-defender" onclick="toggleEnvChip(this)">Microsoft Defender</button>
                        <button class="env-chip" data-category="security" data-value="splunk" onclick="toggleEnvChip(this)">Splunk</button>
                        <button class="env-chip" data-category="security" data-value="elastic" onclick="toggleEnvChip(this)">Elastic</button>
                        <button class="env-chip" data-category="security" data-value="palo-alto" onclick="toggleEnvChip(this)">Palo Alto</button>
                    </div>
                </div>
                <!-- Identity & Mail -->
                <div style="margin-bottom: 14px;">
                    <div style="font-size: 0.75rem; font-weight: 600; color: var(--gray-500); margin-bottom: 8px; text-transform: uppercase;">Identity & Collaboration</div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="env-chip" data-category="identity" data-value="okta" onclick="toggleEnvChip(this)">Okta</button>
                        <button class="env-chip" data-category="identity" data-value="azure-ad" onclick="toggleEnvChip(this)">Azure AD / Entra</button>
                        <button class="env-chip" data-category="identity" data-value="office365" onclick="toggleEnvChip(this)">Office 365</button>
                        <button class="env-chip" data-category="identity" data-value="google-workspace" onclick="toggleEnvChip(this)">Google Workspace</button>
                        <button class="env-chip" data-category="identity" data-value="slack" onclick="toggleEnvChip(this)">Slack</button>
                    </div>
                </div>
                <!-- Threat Focus -->
                <div style="margin-bottom: 0;">
                    <div style="font-size: 0.75rem; font-weight: 600; color: var(--gray-500); margin-bottom: 8px; text-transform: uppercase;">Threat Focus</div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="env-chip" data-category="threat" data-value="ransomware" onclick="toggleEnvChip(this)">Ransomware</button>
                        <button class="env-chip" data-category="threat" data-value="apt" onclick="toggleEnvChip(this)">APT / Nation-State</button>
                        <button class="env-chip" data-category="threat" data-value="supply-chain" onclick="toggleEnvChip(this)">Supply Chain</button>
                        <button class="env-chip" data-category="threat" data-value="zero-day" onclick="toggleEnvChip(this)">Zero-Days</button>
                        <button class="env-chip" data-category="threat" data-value="phishing" onclick="toggleEnvChip(this)">Phishing</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Signals Count -->
        <div class="signals-count" id="signalsCount">Loading signals...</div>

        <!-- Signals List -->
        <div class="signals-list" id="signalsList">
            <div class="loading">Loading security signals...</div>
        </div>
    </div>

    <footer class="footer">
        <p>Powered by <a href="https://ktlystlabs.com">KTLYST Labs</a> | Data aggregated from government advisories, vendor research, and security news</p>
    </footer>

    <script>
        // Configuration - Update this URL to point to your hosted JSON file
        const DATA_URL = '/signals/security-signals-data.json';
        const SUMMARIES_URL = '/signals/security-summaries.json';

        // Store summaries globally for focus tab switching
        let securitySummaries = null;
        let currentFocus = 'detection_engineering';

        // Toggle functions for collapsible sections
        function toggleSummaryDetails() {
            const content = document.getElementById('summaryDetailsContent');
            const arrow = document.getElementById('summaryDetailsArrow');
            const isHidden = content.style.display === 'none';
            content.style.display = isHidden ? 'block' : 'none';
            arrow.style.transform = isHidden ? 'rotate(90deg)' : 'rotate(0deg)';
        }

        function toggleFocusSection() {
            const content = document.getElementById('focusSectionContent');
            const arrow = document.getElementById('focusSectionArrow');
            const isHidden = content.style.display === 'none';
            content.style.display = isHidden ? 'block' : 'none';
            arrow.style.transform = isHidden ? 'rotate(90deg)' : 'rotate(0deg)';
        }

        function toggleEnvFilter() {
            const expanded = document.getElementById('envFilterExpanded');
            const arrow = document.getElementById('envFilterArrow');
            const isHidden = expanded.style.display === 'none';
            expanded.style.display = isHidden ? 'block' : 'none';
            arrow.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
        }

        // Environment Filter State and Functions
        const envFilterState = {
            cloud: [],
            infra: [],
            security: [],
            identity: [],
            threat: []
        };

        const envFilterKeywords = {
            'aws': ['aws', 'amazon', 'ec2', 's3', 'lambda', 'cloudfront', 'rds', 'eks', 'ecs', 'iam'],
            'azure': ['azure', 'microsoft cloud', 'entra', 'intune', 'sentinel', 'defender for cloud'],
            'gcp': ['gcp', 'google cloud', 'gke', 'bigquery', 'cloud run'],
            'on-prem': ['on-prem', 'on-premises', 'data center', 'vmware', 'hyperv'],
            'kubernetes': ['kubernetes', 'k8s', 'kubectl', 'helm', 'container orchestration', 'eks', 'aks', 'gke'],
            'docker': ['docker', 'container', 'dockerfile', 'docker hub'],
            'vmware': ['vmware', 'vsphere', 'esxi', 'vcenter'],
            'terraform': ['terraform', 'infrastructure as code', 'iac', 'hashicorp'],
            'linux': ['linux', 'ubuntu', 'centos', 'rhel', 'debian', 'fedora', 'kernel'],
            'windows': ['windows', 'windows server', 'active directory', 'ntlm', 'kerberos', 'powershell'],
            'crowdstrike': ['crowdstrike', 'falcon', 'crowdstrike falcon'],
            'sentinelone': ['sentinelone', 'sentinel one', 's1'],
            'microsoft-defender': ['defender', 'microsoft defender', 'defender for endpoint', 'mde', 'defender atp'],
            'splunk': ['splunk', 'splunk enterprise', 'splunk cloud'],
            'elastic': ['elastic', 'elasticsearch', 'kibana', 'elastic siem'],
            'palo-alto': ['palo alto', 'pan-os', 'cortex', 'prisma', 'xsoar', 'xdr'],
            'okta': ['okta', 'okta sso', 'okta mfa'],
            'azure-ad': ['azure ad', 'entra', 'azure active directory', 'aad'],
            'office365': ['office 365', 'o365', 'microsoft 365', 'm365', 'exchange online', 'sharepoint online'],
            'google-workspace': ['google workspace', 'gsuite', 'google drive', 'gmail enterprise'],
            'slack': ['slack', 'slack enterprise'],
            'ransomware': ['ransomware', 'lockbit', 'blackcat', 'alphv', 'clop', 'akira', 'play ransomware', 'royal ransomware', 'encryption', 'extortion'],
            'apt': ['apt', 'nation-state', 'state-sponsored', 'advanced persistent', 'lazarus', 'cozy bear', 'fancy bear'],
            'supply-chain': ['supply chain', 'software supply', 'dependency', 'npm', 'pypi', 'package manager', 'solarwinds'],
            'zero-day': ['zero-day', '0-day', 'zero day', 'actively exploited', 'in the wild', 'kev', 'known exploited'],
            'phishing': ['phishing', 'spear-phishing', 'business email compromise', 'bec', 'credential harvesting']
        };

        function toggleEnvChip(chip) {
            const category = chip.dataset.category;
            const value = chip.dataset.value;

            chip.classList.toggle('active');

            if (chip.classList.contains('active')) {
                if (!envFilterState[category].includes(value)) {
                    envFilterState[category].push(value);
                }
            } else {
                envFilterState[category] = envFilterState[category].filter(v => v !== value);
            }

            updateEnvFilterSummary();
            renderSignals();
        }

        function clearEnvFilters() {
            Object.keys(envFilterState).forEach(key => {
                envFilterState[key] = [];
            });
            document.querySelectorAll('.env-chip.active').forEach(chip => {
                chip.classList.remove('active');
            });
            updateEnvFilterSummary();
            renderSignals();
        }

        function updateEnvFilterSummary() {
            const summaryEl = document.getElementById('envFilterSummary');
            const allFilters = [];

            Object.entries(envFilterState).forEach(([category, values]) => {
                values.forEach(value => {
                    const chip = document.querySelector(`.env-chip[data-value="${value}"]`);
                    if (chip) {
                        allFilters.push(chip.textContent);
                    }
                });
            });

            if (allFilters.length === 0) {
                summaryEl.innerHTML = '<span style="font-size: 0.8rem; color: var(--gray-500); font-style: italic;">No filters applied - showing all signals</span>';
            } else {
                summaryEl.innerHTML = allFilters.map(f =>
                    `<span class="env-chip-summary">${f}</span>`
                ).join('');
            }
        }

        function getActiveEnvFilters() {
            const activeKeywords = [];
            Object.entries(envFilterState).forEach(([category, values]) => {
                values.forEach(value => {
                    if (envFilterKeywords[value]) {
                        activeKeywords.push(...envFilterKeywords[value]);
                    }
                });
            });
            return activeKeywords;
        }

        function signalMatchesEnvFilter(signal) {
            const activeKeywords = getActiveEnvFilters();
            if (activeKeywords.length === 0) return true;

            const searchText = [
                signal.title || '',
                signal.summary || '',
                (signal.affected_tech || []).join(' '),
                (signal.tags || []).join(' ')
            ].join(' ').toLowerCase();

            return activeKeywords.some(keyword => searchText.includes(keyword.toLowerCase()));
        }

        // Focus tab switching
        function updateFocusTabStyles() {
            document.querySelectorAll('.focus-tab').forEach(tab => {
                const isActive = tab.dataset.focus === currentFocus;
                tab.style.background = isActive ? '#7c3aed' : '#f5f3ff';
                tab.style.color = isActive ? 'white' : '#7c3aed';
            });
        }

        function renderFocusSummary() {
            if (!securitySummaries || !securitySummaries.industry_focus) {
                document.getElementById('focusSummaryContent').style.display = 'none';
                return;
            }

            const focusData = securitySummaries.industry_focus?.daily?.[currentFocus];
            const focusPanel = document.getElementById('focusSummaryContent');

            if (focusData) {
                focusPanel.style.display = 'block';

                const focusTitles = {
                    detection_engineering: 'üõ°Ô∏è Detection Engineering',
                    soc_operations: 'üñ•Ô∏è SOC Operations',
                    ransomware: 'üîí Ransomware'
                };
                document.getElementById('focusTitle').textContent = `Daily ${focusTitles[currentFocus]} Focus`;

                const genAt = focusData.generated_at ? new Date(focusData.generated_at).toLocaleString() : 'Not yet generated';
                const signalCount = focusData.signal_count || 0;
                document.getElementById('focusMeta').innerHTML = `Generated: ${genAt} | ${signalCount} relevant signals`;

                document.getElementById('focusSummaryText').textContent = focusData.summary || 'No summary available.';

                const threats = focusData.relevant_threats || [];
                document.getElementById('focusThreats').innerHTML = threats.length > 0
                    ? threats.map(t => `<li style="margin-bottom: 6px;">${escapeHtml(t)}</li>`).join('')
                    : '<li style="color: var(--gray-400);">No specific threats identified</li>';

                const recs = focusData.recommendations || [];
                document.getElementById('focusRecs').innerHTML = recs.length > 0
                    ? recs.map(r => `<li style="margin-bottom: 6px;">${escapeHtml(r)}</li>`).join('')
                    : '<li style="color: var(--gray-400);">No specific recommendations</li>';

                const impact = focusData.impact_assessment || '';
                const impactEl = document.getElementById('focusImpact');
                if (impact) {
                    document.getElementById('focusImpactText').textContent = impact;
                    impactEl.style.display = 'block';
                } else {
                    impactEl.style.display = 'none';
                }
            } else {
                focusPanel.style.display = 'none';
            }
        }

        // Load and display AI summaries
        async function loadSummaries() {
            try {
                const response = await fetch(SUMMARIES_URL);
                if (!response.ok) throw new Error('Summaries not available');
                const data = await response.json();

                // Store globally for focus tabs
                securitySummaries = data;

                // Get daily summary (default)
                const summary = data.time_periods?.daily;
                if (!summary) throw new Error('No daily summary available');

                // Update meta
                const genDate = new Date(summary.generated_at);
                const signalCount = summary.signal_count || 0;
                const criticalCount = summary.critical_count || 0;
                const highCount = summary.high_count || 0;
                document.getElementById('summaryMeta').innerHTML =
                    `Generated: ${genDate.toLocaleString()} | ${signalCount} signals analyzed | <span style="color: #dc2626;">${criticalCount} critical</span> | <span style="color: #ea580c;">${highCount} high</span>`;

                // Executive summary
                document.getElementById('executiveSummary').textContent = summary.executive_summary || 'No summary available';

                // Key threats with source references
                const threatsList = document.getElementById('keyThreats');
                threatsList.innerHTML = '';
                const sources = summary.sources || [];
                (summary.key_threats || []).slice(0, 5).forEach(threat => {
                    const li = document.createElement('li');
                    li.style.marginBottom = '8px';

                    // Handle both old format (string) and new format (object with refs)
                    if (typeof threat === 'string') {
                        li.textContent = threat;
                    } else {
                        // New format with references
                        const threatText = document.createElement('span');
                        threatText.textContent = threat.text || threat;
                        li.appendChild(threatText);

                        // Add footnote references
                        if (threat.refs && threat.refs.length > 0 && sources.length > 0) {
                            threat.refs.forEach(refId => {
                                const source = sources.find(s => s.id === refId);
                                if (source && source.url) {
                                    const sup = document.createElement('sup');
                                    const link = document.createElement('a');
                                    link.href = source.url;
                                    link.target = '_blank';
                                    link.rel = 'noopener noreferrer';
                                    link.textContent = `[${refId}]`;
                                    link.style.cssText = 'color: #f97316; text-decoration: none; margin-left: 2px; font-size: 0.75em;';
                                    link.title = source.title || 'Source';
                                    sup.appendChild(link);
                                    li.appendChild(sup);
                                }
                            });
                        }
                    }
                    threatsList.appendChild(li);
                });

                // Key CVEs
                const cvesList = document.getElementById('keyCves');
                cvesList.innerHTML = '';
                (summary.key_cves || []).slice(0, 5).forEach(cve => {
                    const li = document.createElement('li');
                    li.textContent = cve;
                    li.style.marginBottom = '8px';
                    cvesList.appendChild(li);
                });

                // Recommendations
                const recsList = document.getElementById('recommendations');
                recsList.innerHTML = '';
                (summary.recommendations || []).slice(0, 5).forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    li.style.marginBottom = '8px';
                    recsList.appendChild(li);
                });

                // Detection opportunities
                const detOps = summary.detection_opportunities;
                const detOpsEl = document.getElementById('summaryDetectionOps');
                if (detOps) {
                    document.getElementById('summaryDetectionText').textContent = detOps;
                    detOpsEl.style.display = 'block';
                } else {
                    detOpsEl.style.display = 'none';
                }

                // Trends
                const trends = summary.trends || '';
                const trendsEl = document.getElementById('summaryTrends');
                if (trends) {
                    document.getElementById('summaryTrendsText').textContent = trends;
                    trendsEl.style.display = 'block';
                } else {
                    trendsEl.style.display = 'none';
                }

                // Show/hide details toggle based on content
                const detailsToggle = document.getElementById('summaryDetailsToggle');
                if (detOps || trends) {
                    detailsToggle.style.display = 'block';
                } else {
                    detailsToggle.style.display = 'none';
                }

                // Show content, hide loading
                document.getElementById('summaryContent').style.display = 'block';
                document.getElementById('summaryLoading').style.display = 'none';

                // Show focus section if industry focus data exists
                if (data.industry_focus && data.industry_focus.daily) {
                    document.getElementById('focusSectionWrapper').style.display = 'block';
                    renderFocusSummary();

                    // Setup focus tab listeners
                    document.querySelectorAll('.focus-tab').forEach(tab => {
                        tab.addEventListener('click', () => {
                            currentFocus = tab.dataset.focus;
                            updateFocusTabStyles();
                            renderFocusSummary();
                        });
                    });
                }

            } catch (error) {
                document.getElementById('summaryLoading').innerHTML =
                    `<p style="color: var(--gray-500);">AI summary not available. <span style="font-size: 0.8rem;">(${error.message})</span></p>`;
            }
        }

        let allSignals = [];
        let activeFilters = {
            search: '',
            date: '7days',
            sourceType: 'all',
            source: 'all',
            severity: 'all',
            category: 'all'
        };

        // Refresh function for button
        async function loadSignals() {
            document.getElementById('signalsList').innerHTML = '<div class="loading">Refreshing signals...</div>';
            await init();
        }

        // Fetch and initialize
        async function init() {
            try {
                // Load summaries in parallel with signals
                loadSummaries();

                const response = await fetch(DATA_URL);
                if (!response.ok) throw new Error('Failed to load signals');
                allSignals = await response.json();
                updateStats();
                renderSignals();
                setupEventListeners();
                // Update last updated timestamp
                const now = new Date();
                const options = { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                const el = document.getElementById('lastUpdatedTime');
                if (el) el.textContent = now.toLocaleString('en-US', options);
            } catch (error) {
                document.getElementById('signalsList').innerHTML = `
                    <div class="empty-state">
                        <p>Failed to load security signals.</p>
                        <p style="font-size: 0.8rem; margin-top: 8px;">Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        function updateStats() {
            document.getElementById('statTotal').textContent = allSignals.length;
            document.getElementById('statCritical').textContent = allSignals.filter(s => s.severity === 'critical').length;
            document.getElementById('statHigh').textContent = allSignals.filter(s => s.severity === 'high').length;
            document.getElementById('statMedium').textContent = allSignals.filter(s => s.severity === 'medium').length;
            document.getElementById('statSources').textContent = new Set(allSignals.map(s => s.source_name)).size;

            // Category counts
            const cats = {
                cve: allSignals.filter(s => s.signal_category === 'cve').length,
                advisory: allSignals.filter(s => s.signal_category === 'advisory').length,
                apt: allSignals.filter(s => s.signal_category === 'apt').length,
                malware: allSignals.filter(s => s.signal_category === 'malware').length,
                news: allSignals.filter(s => s.signal_category === 'news').length,
                research: allSignals.filter(s => s.signal_category === 'research').length
            };
            document.getElementById('catCve').textContent = cats.cve;
            document.getElementById('catAdvisory').textContent = cats.advisory;
            document.getElementById('catApt').textContent = cats.apt;
            document.getElementById('catMalware').textContent = cats.malware;
            document.getElementById('catNews').textContent = cats.news;
            document.getElementById('catResearch').textContent = cats.research;
        }

        function getFilteredSignals() {
            let filtered = [...allSignals];

            // Search filter
            if (activeFilters.search) {
                const query = activeFilters.search.toLowerCase();
                filtered = filtered.filter(s => {
                    const text = [
                        s.title || '',
                        s.summary || '',
                        s.source_name || '',
                        (s.cve_ids || []).join(' '),
                        (s.threat_actors || []).join(' '),
                        (s.malware_families || []).join(' ')
                    ].join(' ').toLowerCase();
                    return query.split(/\s+/).every(term => text.includes(term));
                });
            }

            // Date filter
            if (activeFilters.date !== 'all') {
                const now = new Date();
                const cutoff = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                if (activeFilters.date === '1day') cutoff.setDate(cutoff.getDate() - 1);
                else if (activeFilters.date === '7days') cutoff.setDate(cutoff.getDate() - 7);
                else if (activeFilters.date === '14days') cutoff.setDate(cutoff.getDate() - 14);
                else if (activeFilters.date === 'month') cutoff.setDate(cutoff.getDate() - 30);
                filtered = filtered.filter(s => !s.source_date || new Date(s.source_date) >= cutoff);
            }

            // Other filters
            if (activeFilters.sourceType !== 'all') {
                filtered = filtered.filter(s => s.source_type === activeFilters.sourceType);
            }
            if (activeFilters.source !== 'all') {
                filtered = filtered.filter(s => s.source_name === activeFilters.source);
            }
            if (activeFilters.severity !== 'all') {
                filtered = filtered.filter(s => s.severity === activeFilters.severity);
            }
            if (activeFilters.category !== 'all') {
                filtered = filtered.filter(s => s.signal_category === activeFilters.category);
            }

            // Environment filter
            filtered = filtered.filter(s => signalMatchesEnvFilter(s));

            // Sort by date
            filtered.sort((a, b) => new Date(b.source_date || '2020-01-01') - new Date(a.source_date || '2020-01-01'));

            return filtered;
        }

        function getSourceTypeColor(sourceType) {
            const colors = {
                government: '#0369a1',
                vendor_research: '#7c3aed',
                independent_research: '#059669',
                exploit_tracking: '#dc2626',
                threat_tracking: '#ea580c',
                news: '#6b7280',
                community: '#2563eb'
            };
            return colors[sourceType] || '#6b7280';
        }

        function getDateInfo(dateStr) {
            if (!dateStr) return { display: 'N/A', isFresh: false, isStale: false };
            const date = new Date(dateStr);
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            let display;
            if (diffDays === 0) display = 'Today';
            else if (diffDays === 1) display = 'Yesterday';
            else if (diffDays < 7) display = `${diffDays} days ago`;
            else if (diffDays < 30) display = `${Math.floor(diffDays / 7)} weeks ago`;
            else display = date.toLocaleDateString();

            return {
                display,
                isFresh: diffDays <= 2,
                isStale: diffDays > 14
            };
        }

        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        function renderSignals() {
            const filtered = getFilteredSignals();
            document.getElementById('signalsCount').textContent = `Showing ${filtered.length} of ${allSignals.length} signals`;

            if (filtered.length === 0) {
                document.getElementById('signalsList').innerHTML = `
                    <div class="empty-state">No security signals match your filters</div>
                `;
                return;
            }

            const html = filtered.slice(0, 100).map(s => {
                const dateInfo = getDateInfo(s.source_date);
                const sourceColor = getSourceTypeColor(s.source_type);

                const cveHtml = (s.cve_ids || []).slice(0, 3).map(cve =>
                    `<span class="tag-cve">${escapeHtml(cve)}</span>`
                ).join('');

                const actorHtml = (s.threat_actors || []).slice(0, 2).map(actor =>
                    `<span class="tag-actor">${escapeHtml(actor)}</span>`
                ).join('');

                const malwareHtml = (s.malware_families || []).slice(0, 2).map(m =>
                    `<span class="tag-malware">${escapeHtml(m)}</span>`
                ).join('');

                const hasTags = cveHtml || actorHtml || malwareHtml;

                return `
                    <div class="signal-card ${s.severity || ''}">
                        <div class="signal-header">
                            <div>
                                <div class="signal-title">
                                    ${s.source_url ? `<a href="${escapeHtml(s.source_url)}" target="_blank" rel="noopener">${escapeHtml(s.title)}</a>` : escapeHtml(s.title)}
                                </div>
                                <div class="signal-source">${escapeHtml(s.source_name)}</div>
                            </div>
                            <div class="signal-badges">
                                <span class="badge badge-severity badge-${s.severity || 'informational'}">${(s.severity || 'info').toUpperCase()}</span>
                                <span class="badge" style="background: ${sourceColor}; color: white;">${(s.source_type || 'unknown').replace(/_/g, ' ')}</span>
                                <span class="badge badge-date ${dateInfo.isFresh ? 'fresh' : ''} ${dateInfo.isStale ? 'stale' : ''}">${dateInfo.isFresh ? 'üî• ' : dateInfo.isStale ? '‚ö†Ô∏è ' : ''}${dateInfo.display}</span>
                            </div>
                        </div>
                        <div class="badge badge-category" style="margin-bottom: 10px;">${escapeHtml((s.signal_category || 'general').replace(/_/g, ' '))}</div>
                        ${hasTags ? `<div class="signal-tags">${cveHtml}${actorHtml}${malwareHtml}</div>` : ''}
                        <div class="signal-summary">${escapeHtml(s.summary || '')}</div>
                        <div class="signal-footer">
                            ${s.source_url ? `<a href="${escapeHtml(s.source_url)}" target="_blank" rel="noopener" class="signal-link">View Source ‚Üí</a>` : '<span></span>'}
                            <span style="font-size: 0.8rem; color: var(--gray-400);">${s.source_date || 'No date'}</span>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('signalsList').innerHTML = html;
        }

        function setupEventListeners() {
            // Search
            let searchTimeout;
            document.getElementById('searchInput').addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    activeFilters.search = e.target.value;
                    renderSignals();
                }, 300);
            });

            // Dropdowns
            document.getElementById('filterDate').addEventListener('change', (e) => {
                activeFilters.date = e.target.value;
                renderSignals();
            });

            document.getElementById('filterSourceType').addEventListener('change', (e) => {
                activeFilters.sourceType = e.target.value;
                renderSignals();
            });

            document.getElementById('filterSource').addEventListener('change', (e) => {
                activeFilters.source = e.target.value;
                renderSignals();
            });

            document.getElementById('filterSeverity').addEventListener('change', (e) => {
                activeFilters.severity = e.target.value;
                // Also update chips to match dropdown
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                const matchingChip = document.querySelector(`.chip[data-severity="${e.target.value}"]`);
                if (matchingChip) matchingChip.classList.add('active');
                renderSignals();
            });

            document.getElementById('filterCategory').addEventListener('change', (e) => {
                activeFilters.category = e.target.value;
                // Also update category chips to match dropdown
                document.querySelectorAll('.category-chip').forEach(c => {
                    c.style.fontWeight = 'normal';
                    c.style.boxShadow = 'none';
                });
                const matchingCatChip = document.querySelector(`.category-chip[data-category="${e.target.value}"]`);
                if (matchingCatChip) {
                    matchingCatChip.style.fontWeight = 'bold';
                    matchingCatChip.style.boxShadow = '0 0 0 2px #1e3a5f';
                }
                renderSignals();
            });

            // Severity chips
            document.querySelectorAll('.chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                    activeFilters.severity = chip.dataset.severity;
                    // Sync dropdown
                    document.getElementById('filterSeverity').value = chip.dataset.severity;
                    renderSignals();
                });
            });

            // Category chips
            document.querySelectorAll('.category-chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    document.querySelectorAll('.category-chip').forEach(c => {
                        c.style.fontWeight = 'normal';
                        c.style.boxShadow = 'none';
                    });
                    chip.style.fontWeight = 'bold';
                    chip.style.boxShadow = '0 0 0 2px #1e3a5f';
                    activeFilters.category = chip.dataset.category;
                    // Sync dropdown
                    document.getElementById('filterCategory').value = chip.dataset.category;
                    renderSignals();
                });
            });
        }

        // Initialize
        init();
    </script>
</body>
</html>
